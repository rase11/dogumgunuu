<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Prens ve Prensesin Macerası</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            height: 100vh;
            overflow: hidden; /* Kaydırmayı engelle */
        }
        #game-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            touch-action: none; /* Tarayıcı dokunma eylemlerini devre dışı bırak */
        }
    </style>
</head>
<body>

<div id="game-container"></div>

<script>
    // Oyun yapılandırması
    const config = {
        type: Phaser.AUTO,
        scale: {
            mode: Phaser.Scale.FIT, // Ekranı doldur ama en-boy oranını koru
            autoCenter: Phaser.Scale.CENTER_BOTH,
            width: 800,
            height: 450
        },
        parent: 'game-container',
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 600 }, // Yerçekimi
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    const game = new Phaser.Game(config);

    let player;
    let princess;
    let platforms;
    let cursors;
    let gameOver = false;
    let finalImage;
    let touchControls = { left: false, right: false, jump: false };

    // Görselleri yükle
    function preload() {
        this.load.setBaseURL('https://labs.phaser.io/assets/'); // Geçici assetler için
        this.load.image('sky', 'skies/space3.png'); // Gökyüzü (Geçici)
        this.load.image('ground', 'sprites/platform.png'); // Platform (Geçici)
        
        // Bizim oluşturduğumuz görseller (Base64 olarak gömülü - normalde dosya yolu olur)
        // NOT: Gerçek bir projede bu görselleri sunucuya yükleyip linklerini kullanmalısın.
        // Burada örnek olması için doğrudan gömüyorum.
        
        // image_2.png'dan karakterler (Bunu bir sprite sheet gibi düşüneceğiz)
        // Prens: x=200, y=300, w=150, h=400 civarı
        // Prenses: x=600, y=300, w=350, h=400 civarı
        // Basitlik için tek bir görseli yükleyip, kodla kırpacağız.
        this.load.spritesheet('characters', 'karakterler.png', { frameWidth: 425, frameHeight: 450 });

        // Final Sahnesi (image_3.png)
        this.load.image('finalScene', 'final.png');
    }

    // Sahneyi oluştur
    function create() {
        // Arka plan (Daha tatlı bir gökyüzü yapılabilir)
        this.add.rectangle(0, 0, 2400, 600, 0x87CEEB).setOrigin(0, 0); // Açık mavi gökyüzü

        // Platformlar
        platforms = this.physics.add.staticGroup();

        // Zemin
        for (let i = 0; i < 6; i++) {
            platforms.create(i * 400, 430, 'ground').setScale(1).refreshBody().setTint(0x2E8B57); // Yeşil zemin
        }

        // Engeller ve Üst Platformlar
        platforms.create(600, 300, 'ground').setScale(0.5).refreshBody().setTint(0x2E8B57);
        platforms.create(50, 200, 'ground').setScale(0.5).refreshBody().setTint(0x2E8B57);
        platforms.create(1100, 250, 'ground').setScale(0.5).refreshBody().setTint(0x2E8B57);
        platforms.create(1600, 320, 'ground').setScale(0.5).refreshBody().setTint(0x2E8B57);

        // Oyuncu (Prens)
        // Burada sprite sheet'in ilk karesini (prens) kullanıyoruz.
        player = this.physics.add.sprite(100, 300, 'characters', 0).setScale(0.25);
        player.setBounce(0.1);
        player.setCollideWorldBounds(false); // Dünyadan düşebilsin

        // Oyuncu Animasyonları (Basitlik için tek kare)
        this.anims.create({
            key: 'turn',
            frames: [ { key: 'characters', frame: 0 } ],
            frameRate: 20
        });

        // Prenses
        // Sprite sheet'in ikinci karesini (prenses) kullanıyoruz.
        princess = this.physics.add.staticSprite(2200, 330, 'characters', 1).setScale(0.25);

        // Çarpışmalar
        this.physics.add.collider(player, platforms);
        this.physics.add.overlap(player, princess, reachPrincess, null, this);

        // Kamera
        this.cameras.main.setBounds(0, 0, 2400, 450);
        this.cameras.main.startFollow(player, true, 0.08, 0.08);

        // Kontroller (Klavye)
        cursors = this.input.keyboard.createCursorKeys();

        // Kontroller (Dokunmatik - Mobil İçin)
        setupTouchControls(this);

        // Final Resmi (Başlangıçta gizli)
        finalImage = this.add.image(this.cameras.main.width / 2, this.cameras.main.height / 2, 'finalScene');
        finalImage.setOrigin(0.5);
        finalImage.setScrollFactor(0); // Kamerayla hareket etmesin
        finalImage.setVisible(false);
        finalImage.setDepth(10); // En üstte görünsün
        // Resmi ekrana sığdır
        let scaleX = this.cameras.main.width / finalImage.width;
        let scaleY = this.cameras.main.height / finalImage.height;
        let scale = Math.max(scaleX, scaleY);
        finalImage.setScale(scale);
    }

    // Her karede çalışır
    function update() {
        if (gameOver) {
            return;
        }

        // Hareket Mantığı (Klavye veya Dokunmatik)
        if (cursors.left.isDown || touchControls.left) {
            player.setVelocityX(-200);
            player.setFlipX(true); // Sola dönsün
        } else if (cursors.right.isDown || touchControls.right) {
            player.setVelocityX(200);
            player.setFlipX(false); // Sağa dönsün
        } else {
            player.setVelocityX(0);
        }

        // Zıplama
        if ((cursors.up.isDown || touchControls.jump) && player.body.touching.down) {
            player.setVelocityY(-450);
        }

        // Dünyadan Düşme Kontrolü
        if (player.y > 500) {
            this.scene.restart(); // Bölümü yeniden başlat
        }
    }

    // Prenses'e ulaşınca
    function reachPrincess(player, princess) {
        this.physics.pause(); // Fiziği durdur
        gameOver = true;
        
        // Karakterleri gizle
        player.setVisible(false);
        princess.setVisible(false);

        // Final resmini göster
        finalImage.setVisible(true);
        
        // İsteğe bağlı: Bir tebrik yazısı ekle
        let text = this.add.text(this.cameras.main.width / 2, 50, 'Mutlu Son!', {
            fontSize: '32px',
            fill: '#fff',
            fontStyle: 'bold',
            stroke: '#000',
            strokeThickness: 4
        });
        text.setOrigin(0.5);
        text.setScrollFactor(0);
        text.setDepth(11);
    }

    // Dokunmatik Kontrolleri Ayarla
    function setupTouchControls(scene) {
        // Ekranın sol yarısı sola, sağ yarısı sağa gitmek için.
        // Tıklama/Dokunma zıplamak için.

        scene.input.on('pointerdown', function (pointer) {
            if (pointer.x < scene.scale.width / 2) {
                touchControls.left = true;
                touchControls.right = false;
            } else {
                touchControls.right = true;
                touchControls.left = false;
            }
            touchControls.jump = true; // Her dokunuşta zıplamayı dene
        });

        scene.input.on('pointerup', function (pointer) {
            touchControls.left = false;
            touchControls.right = false;
            touchControls.jump = false;
        });
        
        // Çoklu dokunma için (daha iyi kontrol)
        scene.input.addPointer(1); // İkinci bir parmak izni ekle
    }
</script>

</body>
</html>