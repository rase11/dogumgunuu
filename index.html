<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sana Ã–zel Bir Oyun - Mobil</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { 
            margin: 0; 
            background-color: #000; 
            overflow: hidden; 
            font-family: 'Arial Black', sans-serif;
            touch-action: none; /* Mobilde kaydÄ±rmayÄ± engelle */
        }
        #game-container { 
            width: 100vw; 
            height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }

        /* DÄ°K TUTMA UYARISI Ä°Ã‡Ä°N STÄ°L */
        #orientation-warning {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            color: #fff;
            display: none; /* BaÅŸlangÄ±Ã§ta gizli */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            text-align: center;
        }
        
        /* Sadece ekran dikse (portrait) uyarÄ±yÄ± gÃ¶ster */
        @media screen and (orientation: portrait) {
            #orientation-warning { display: flex; }
            #game-container { display: none; }
        }
    </style>
</head>
<body>

<div id="orientation-warning">
    <h1>ðŸ”„</h1>
    <h2>LÃ¼tfen Telefonu Yan Ã‡evir</h2>
    <p>Oyun sadece yatay modda oynanabilir.</p>
</div>

<div id="game-container"></div>

<script>
    const config = {
        type: Phaser.AUTO,
        parent: 'game-container',
        scale: {
            // MOBÄ°L Ä°Ã‡Ä°N KRÄ°TÄ°K AYAR:
            mode: Phaser.Scale.RESIZE, // Ekran ne kadarsa oyun o kadar geniÅŸlesin
            width: '100%',
            height: '100%',
            autoCenter: Phaser.Scale.CENTER_BOTH
        },
        backgroundColor: '#87CEEB',
        antialias: true,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 600 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    const game = new Phaser.Game(config);

    let player;
    let princess;
    let cursors;
    let finalImage;
    let finalImageContainer;
    let isGameFinished = false;
    let score = 0;
    let scoreText;
    let hearts;
    let music;
    let movingPlatforms;
    let emitter;
    
    // Mobil TuÅŸlar
    let btnLeft, btnRight, btnJump;
    let isLeftDown = false;
    let isRightDown = false;
    let isJumpDown = false;

    // Ekran boyutlarÄ± (Dinamik olacak)
    let mapWidth = 4000; 

    function preload() {
        this.load.audio('theme', 'https://labs.phaser.io/assets/audio/oedipus_wizball_highscore.ogg');
        this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
        this.load.image('sparkle', 'https://labs.phaser.io/assets/particles/blue.png');
        
        // SENÄ°N RESÄ°MLERÄ°N
        this.load.image('prens', 'prens.png');
        this.load.image('prenses', 'prenses.png');
        this.load.image('finalScene', 'final.png');
    }

    function create() {
        // --- TAM EKRAN MANTIÄžI ---
        // Ekrana dokununca tam ekran yap (TarayÄ±cÄ± Ã§ubuklarÄ± gitsin)
        this.input.once('pointerdown', () => {
            if (this.scale.isFullscreen) return;
            this.scale.startFullscreen();
        });

        // --- MÃœZÄ°K ---
        music = this.sound.add('theme', { loop: true, volume: 0.5 });
        this.input.once('pointerdown', () => { if (!music.isPlaying) music.play(); });

        // --- HARÄ°TA ---
        const platforms = this.physics.add.staticGroup();
        
        // Zemin (Ekran geniÅŸledikÃ§e sorun olmasÄ±n diye Ã§ok uzun yapÄ±yoruz)
        for (let i = 0; i < mapWidth / 100; i++) {
            platforms.create(i * 400, this.scale.height - 30, 'ground').setScale(1).refreshBody().setTint(0x2E8B57);
        }

        // --- HAREKETLÄ° PLATFORMLAR ---
        movingPlatforms = this.physics.add.group({allowGravity: false, immovable: true});
        
        // KoordinatlarÄ± ekran yÃ¼ksekliÄŸine gÃ¶re oranlayalÄ±m (this.scale.height)
        let groundY = this.scale.height - 30;
        
        let mp1 = movingPlatforms.create(1400, groundY - 150, 'ground').setScale(0.4).setTint(0x8B4513);
        mp1.setMoveData(1200, 1600, 100);

        let mp2 = movingPlatforms.create(2800, groundY - 200, 'ground').setScale(0.4).setTint(0x8B4513);
        mp2.setMoveData(2600, 3000, 150);

        // SABÄ°T ENGELLER
        createObstacle(platforms, 500, groundY - 120, 0.5);
        createObstacle(platforms, 800, groundY - 220, 0.6);
        createObstacle(platforms, 1800, groundY - 150, 0.4);
        createObstacle(platforms, 2100, groundY - 250, 0.5);
        createObstacle(platforms, 3300, groundY - 120, 0.7);
        createObstacle(platforms, 3600, groundY - 200, 0.5);

        // --- EFEKT ---
        emitter = this.add.particles('sparkle').createEmitter({
            speed: { min: -50, max: 50 },
            angle: { min: 0, max: 360 },
            scale: { start: 0.2, end: 0 },
            blendMode: 'ADD',
            on: false,
            lifespan: 300,
            gravityY: -100
        });

        // --- OYUNCU ---
        player = this.physics.add.sprite(100, groundY - 100, 'prens');
        player.setDisplaySize(60, 96);
        player.setBounce(0.1);
        player.setCollideWorldBounds(false); // DÃ¼nyadan dÃ¼ÅŸebilsin
        emitter.startFollow(player);

        // --- PRENSES ---
        princess = this.physics.add.staticSprite(mapWidth - 200, groundY - 100, 'prenses');
        princess.setDisplaySize(60, 96);
        princess.setFlipX(true);

        // --- KALPLER ---
        hearts = this.physics.add.group();
        for (let i = 0; i < 15; i++) {
            let x = Phaser.Math.Between(300, mapWidth - 300);
            let y = Phaser.Math.Between(100, groundY - 150);
            let heart = hearts.create(x, y, 'ground');
            heart.setTint(0xFF0000);
            heart.setDisplaySize(40, 40);
            heart.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));
        }

        // --- ETKÄ°LEÅžÄ°MLER ---
        this.physics.add.collider(player, platforms);
        this.physics.add.collider(player, movingPlatforms, moveWithPlatform, null, this);
        this.physics.add.collider(hearts, platforms);
        this.physics.add.collider(hearts, movingPlatforms);
        this.physics.add.overlap(player, princess, reachPrincess, null, this);
        this.physics.add.overlap(player, hearts, collectHeart, null, this);

        // --- ARAYÃœZ ---
        scoreText = this.add.text(20, 20, 'Toplanan Sevgi: 0', { 
            fontSize: '28px', fill: '#FFF', fontStyle: 'bold', stroke: '#000', strokeThickness: 4
        }).setScrollFactor(0);

        // --- KAMERA ---
        this.cameras.main.setBounds(0, 0, mapWidth, this.scale.height);
        this.cameras.main.startFollow(player, true, 0.08, 0.08);

        // --- MOBÄ°L KONTROLLER ---
        createVirtualButtons(this);
        cursors = this.input.keyboard.createCursorKeys();

        // --- FÄ°NAL RESMÄ° ---
        finalImageContainer = this.add.container(this.scale.width/2, this.scale.height/2).setScrollFactor(0).setVisible(false).setDepth(100);
        finalImage = this.add.image(0, 0, 'finalScene');
        finalImageContainer.add(finalImage);

        this.input.addPointer(2);

        // Ekran boyutu deÄŸiÅŸirse (Ã¶rn: telefon dÃ¶ndÃ¼rÃ¼lÃ¼rse) tuÅŸlarÄ± yeniden hizala
        this.scale.on('resize', resize, this);
    }

    function resize (gameSize) {
        // Ekran boyutu deÄŸiÅŸince kamerayÄ± ve tuÅŸlarÄ± gÃ¼ncelle
        const width = gameSize.width;
        const height = gameSize.height;

        this.cameras.main.setViewport(0, 0, width, height);
        
        // TuÅŸlarÄ±n yerini gÃ¼ncelle
        if(btnLeft) {
            btnLeft.setPosition(40, height - 130);
            btnRight.setPosition(180, height - 130);
            btnJump.setPosition(width - 150, height - 130);
        }
    }

    function update() {
        if (isGameFinished) return;

        // Platform Hareketleri
        movingPlatforms.children.iterate(function (platform) {
            if (platform.moveRight) {
                platform.body.setVelocityX(platform.moveSpeed);
                if (platform.x > platform.maxMoveX) platform.moveRight = false;
            } else {
                platform.body.setVelocityX(-platform.moveSpeed);
                if (platform.x < platform.minMoveX) platform.moveRight = true;
            }
        });

        let isMoving = false;
        if (cursors.left.isDown || isLeftDown) {
            player.setVelocityX(-220);
            player.setFlipX(true);
            isMoving = true;
        } else if (cursors.right.isDown || isRightDown) {
            player.setVelocityX(220);
            player.setFlipX(false);
            isMoving = true;
        } else {
            player.setVelocityX(0);
        }

        if (isMoving && player.body.touching.down) {
            emitter.on = true;
        } else {
            emitter.on = false;
        }

        if ((cursors.up.isDown || isJumpDown) && player.body.touching.down) {
            player.setVelocityY(-550);
            emitter.on = false;
        }

        // DÃ¼nyadan DÃ¼ÅŸme KontrolÃ¼
        if (player.y > this.scale.height + 100) {
            this.scene.restart();
            score = 0;
        }
    }

    function moveWithPlatform(player, platform) {
        if (player.body.touching.down && platform.body.touching.up) {
            player.body.velocity.x += platform.body.velocity.x;
        }
    }

    function createObstacle(group, x, y, scale) {
        group.create(x, y, 'ground').setScale(scale).refreshBody().setTint(0x8B4513);
    }

    Phaser.GameObjects.Sprite.prototype.setMoveData = function(min, max, speed) {
        this.minMoveX = min;
        this.maxMoveX = max;
        this.moveSpeed = speed;
        this.moveRight = true;
    };

    function collectHeart (player, heart) {
        heart.disableBody(true, true);
        score += 10;
        scoreText.setText('Toplanan Sevgi: ' + score);
    }

    function reachPrincess(player, princess) {
        isGameFinished = true;
        this.physics.pause();
        player.setVisible(false);
        princess.setVisible(false);
        scoreText.setVisible(false);
        btnLeft.setVisible(false);
        btnRight.setVisible(false);
        btnJump.setVisible(false);
        emitter.setVisible(false);

        finalImageContainer.setVisible(true);
        finalImageContainer.setPosition(this.scale.width / 2, this.scale.height / 2); // Merkeze al

        // Final resmini ekrana sÄ±ÄŸdÄ±r (Cover modu)
        const screenWidth = this.scale.width;
        const screenHeight = this.scale.height;
        
        // Resmi ekranÄ± KAPLAYACAK ÅŸekilde ayarla (En/boy oranÄ±nÄ± bozmadan)
        // EÄŸer sÄ±ÄŸsÄ±n (tamamÄ± gÃ¶rÃ¼nsÃ¼n) istiyorsan Math.min yap.
        // EÄŸer boÅŸluk kalmasÄ±n (cover) istiyorsan Math.max yap.
        const scaleFactor = Math.min(screenWidth / finalImage.width, screenHeight / finalImage.height);
        finalImage.setScale(scaleFactor);
        
        this.add.text(this.scale.width / 2, 50, 'MUTLU SON â¤ï¸', {
            fontSize: '40px', fill: '#fff', stroke: '#000', strokeThickness: 6, fontFamily: 'Arial Black'
        }).setOrigin(0.5).setScrollFactor(0).setDepth(101);
    }

    function createVirtualButtons(scene) {
        // TuÅŸlarÄ± ekranÄ±n en altÄ±na hizala
        const h = scene.scale.height;
        const w = scene.scale.width;
        
        const style = { fontSize: '80px', fill: '#FFF', stroke: '#000', strokeThickness: 4 };

        // KonumlarÄ± h (height) Ã¼zerinden hesaplÄ±yoruz
        btnLeft = scene.add.text(40, h - 130, 'â¬…ï¸', style).setScrollFactor(0).setInteractive();
        btnLeft.on('pointerdown', () => { isLeftDown = true; });
        btnLeft.on('pointerup', () => { isLeftDown = false; });
        btnLeft.on('pointerout', () => { isLeftDown = false; });

        btnRight = scene.add.text(180, h - 130, 'âž¡ï¸', style).setScrollFactor(0).setInteractive();
        btnRight.on('pointerdown', () => { isRightDown = true; });
        btnRight.on('pointerup', () => { isRightDown = false; });
        btnRight.on('pointerout', () => { isRightDown = false; });

        btnJump = scene.add.text(w - 150, h - 130, 'â«', style).setScrollFactor(0).setInteractive();
        btnJump.on('pointerdown', () => { isJumpDown = true; });
        btnJump.on('pointerup', () => { isJumpDown = false; });
        btnJump.on('pointerout', () => { isJumpDown = false; });
    }
</script>

</body>
</html>
