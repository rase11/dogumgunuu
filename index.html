<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Sana √ñzel Bir Oyun ‚Äî Final</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        html,body { margin:0; padding:0; height:100%; background:#000; overflow: hidden; }
        body {
            font-family: "Arial Black", Arial, sans-serif;
            touch-action: none; /* Mobilde s√ºr√ºklemeyi engelle */
            -webkit-user-select:none;
            user-select:none;
        }
        #game-container { width:100%; height:100%; }
        
        /* UYARI EKRANI STƒ∞Lƒ∞ */
        #orientation-warning {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(20, 20, 20, 0.95); /* Hafif ≈üeffaf siyah */
            color:#fff; z-index:9999;
            display:none; /* Ba≈ülangƒ±√ßta gizli, JS ile a√ßacaƒüƒ±z */
            flex-direction:column; justify-content:center; align-items:center;
            text-align:center;
        }
        #orientation-warning h1 { font-size:60px; margin:0 0 20px 0; }
        #orientation-warning p { font-size: 18px; max-width: 80%; margin-bottom: 30px; }
        
        /* OYUNA GE√á BUTONU (Kurtarƒ±cƒ± Buton) */
        #force-play-btn {
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            background-color: #e74c3c;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        #force-play-btn:active { transform: scale(0.95); }

    </style>
</head>
<body>

<div id="orientation-warning">
    <h1>üì±‚ÜîÔ∏è</h1>
    <h2>L√ºtfen Telefonu Yan √áevir</h2>
    <p>Oyun en iyi yatay ekranda oynanƒ±r.</p>
    <button id="force-play-btn">Yine de Oyuna Gir</button>
</div>

<div id="game-container"></div>

<script>
(() => {
    // --- EKRAN Y√ñN√ú KONTROL√ú ---
    const warningDiv = document.getElementById('orientation-warning');
    const forceBtn = document.getElementById('force-play-btn');
    
    function checkOrientation() {
        // Eƒüer ekranƒ±n boyu eninden b√ºy√ºkse (Dik duruyorsa)
        if (window.innerHeight > window.innerWidth) {
            warningDiv.style.display = 'flex';
        } else {
            warningDiv.style.display = 'none';
        }
    }

    // ƒ∞lk a√ßƒ±lƒ±≈üta kontrol et
    checkOrientation();

    // Ekran d√∂nd√ºk√ße kontrol et
    window.addEventListener('resize', checkOrientation);

    // "Yine de Oyuna Gir" butonuna basarsa uyarƒ±yƒ± zorla kapat
    forceBtn.addEventListener('click', () => {
        warningDiv.style.display = 'none';
        // Artƒ±k resize olsa bile uyarƒ± √ßƒ±kmasƒ±n diye listener'ƒ± kaldƒ±rƒ±yoruz
        window.removeEventListener('resize', checkOrientation);
        // Oyunu tam ekran yapmayƒ± dene
        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen().catch(() => {});
        }
    });

    // --- OYUN AYARLARI ---
    const MAP_WIDTH = 4000;
    const GROUND_HEIGHT = 64;

    const config = {
        type: Phaser.AUTO,
        parent: 'game-container',
        scale: {
            mode: Phaser.Scale.RESIZE, // Ekranƒ± doldur
            width: '100%',
            height: '100%',
            autoCenter: Phaser.Scale.CENTER_BOTH
        },
        backgroundColor: '#87CEEB',
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 1300 },
                debug: false
            }
        },
        scene: { preload, create, update }
    };

    const game = new Phaser.Game(config);

    let player, princess, cursors, scoreText, hearts, music;
    let emitter, bgFar, bgMid, bgFront;
    let btnLeft, btnRight, btnJump;
    let isLeft = false, isRight = false, isJump = false;
    let platforms;

    function preload() {
        // --- G√ñRSELLERƒ∞ Y√úKLE ---
        this.load.audio('theme', 'muzik.mp3');

        // G√ºvenli Linkler
        this.load.image('sky', 'https://labs.phaser.io/assets/skies/sky4.png');
        this.load.image('clouds', 'https://labs.phaser.io/assets/skies/clouds.png');
        this.load.image('clouds2', 'https://labs.phaser.io/assets/skies/space3.png');
        this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
        this.load.image('sparkle', 'https://labs.phaser.io/assets/particles/blue.png');
        this.load.image('heart', 'https://labs.phaser.io/assets/sprites/heart.png');

        // Senin y√ºklediƒüin dosyalar
        this.load.image('prens', 'prens.png');
        this.load.image('prenses', 'prenses.png');
        this.load.image('finalScene', 'final.png');
    }

    function create() {
        // Ekrana ilk dokunu≈üta tam ekran yap ve m√ºzik ba≈ülat
        this.input.once('pointerdown', () => {
            if (!this.scale.isFullscreen && this.scale.startFullscreen) {
                this.scale.startFullscreen().catch(() => {});
            }
            if (!music) {
                music = this.sound.add('theme', { loop: true, volume: 0.5 });
                music.play();
            } else if (!music.isPlaying) {
                music.play();
            }
        });

        // PARALLAX ARKA PLAN
        bgFar = this.add.tileSprite(0, 0, this.scale.width, this.scale.height, 'sky').setOrigin(0).setScrollFactor(0);
        bgMid = this.add.tileSprite(0, 0, this.scale.width, this.scale.height * 0.6, 'clouds2').setOrigin(0).setScrollFactor(0);
        bgFront = this.add.tileSprite(0, this.scale.height * 0.05, this.scale.width, this.scale.height * 0.25, 'clouds').setOrigin(0).setScrollFactor(0);

        // KAMERA VE D√úNYA SINIRLARI
        this.cameras.main.setBounds(0, 0, MAP_WIDTH, this.scale.height);
        this.physics.world.setBounds(0, 0, MAP_WIDTH, this.scale.height);

        // PLATFORMLAR
        platforms = this.physics.add.staticGroup();
        
        // Zeminleri olu≈ütur
        createFloor(this, platforms, 0, 900);
        createFloor(this, platforms, 1000, 1600);
        createFloor(this, platforms, 1700, 2300);
        createFloor(this, platforms, 2500, MAP_WIDTH);

        const bottomY = this.scale.height - (GROUND_HEIGHT / 2);

        // Bloklar
        createBlock(platforms, 450, bottomY - 90);
        createBlock(platforms, 650, bottomY - 190);
        createBlock(platforms, 1200, bottomY - 120);
        createBlock(platforms, 2100, bottomY - 110);

        // Hareketli Platformlar
        const moving = this.physics.add.group({ allowGravity: false, immovable: true });
        
        const mp1 = moving.create(900, bottomY - 120, 'ground').setDisplaySize(150, 32).setTint(0x8B4513).refreshBody();
        setMovingData(mp1, 850, 950, 80);
        
        const mp2 = moving.create(2600, bottomY - 90, 'ground').setDisplaySize(140, 32).setTint(0x8B4513).refreshBody();
        setMovingData(mp2, 2450, 2750, 120);

        // PRENS EFEKTƒ∞
        const particles = this.add.particles('sparkle');
        emitter = particles.createEmitter({
            speed: { min: -40, max: 40 },
            scale: { start: 0.18, end: 0 },
            lifespan: 350,
            blendMode: 'ADD',
            on: false
        });

        // PRENS OLU≈ûTURMA
        const firstFloor = platforms.getChildren()[0];
        const startX = 100;
        // Zeminin tam √ºst√ºne koyuyoruz
        const startY = this.scale.height - GROUND_HEIGHT - 50; 

        player = this.physics.add.sprite(startX, startY, 'prens');
        player.setOrigin(0.5, 1); // Ayaklardan hizala
        player.setDisplaySize(64, 96);
        
        // HITBOX AYARI (G√∂vdeye g√∂re ayarla)
        player.body.setSize(40, 80);
        player.body.setOffset(12, 16); // G√∂rselin ortasƒ±na denk gelecek ≈üekilde kaydƒ±r
        
        player.setCollideWorldBounds(true);
        player.setBounce(0);
        
        emitter.startFollow(player);

        // PRENSES
        princess = this.physics.add.staticSprite(MAP_WIDTH - 220, this.scale.height - GROUND_HEIGHT, 'prenses');
        princess.setOrigin(0.5, 1);
        princess.setDisplaySize(64, 96);
        princess.refreshBody();

        // KALPLER
        hearts = this.physics.add.group();
        for (let i = 0; i < 15; i++) {
            let x = Phaser.Math.Between(300, MAP_WIDTH - 400);
            let y = Phaser.Math.Between(100, bottomY - 200);
            const h = hearts.create(x, y, 'heart');
            h.setDisplaySize(32, 32);
            h.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));
            h.body.setCircle(14);
        }

        // √áARPI≈ûMALAR
        this.physics.add.collider(player, platforms);
        this.physics.add.collider(player, moving, moveWithPlatform);
        this.physics.add.collider(hearts, platforms);
        this.physics.add.collider(hearts, moving);
        this.physics.add.overlap(player, hearts, collectHeart, null, this);
        this.physics.add.overlap(player, princess, reachPrincess, null, this);

        // SKOR TABLOSU
        scoreText = this.add.text(20, 20, 'Toplanan Sevgi: 0', {
            fontSize: '26px', fill: '#fff', stroke: '#000', strokeThickness: 4
        }).setScrollFactor(0).setDepth(10);

        // KAMERA TAKƒ∞Bƒ∞
        this.cameras.main.startFollow(player, true, 0.08, 0.08);

        // MOBƒ∞L TU≈ûLAR
        createMobileButtons(this);
        cursors = this.input.keyboard.createCursorKeys();
        this.input.addPointer(2);

        // Fƒ∞NAL SAHNESƒ∞ (Gizli)
        const finalContainer = this.add.container(0, 0).setDepth(999).setScrollFactor(0).setVisible(false);
        const finalImg = this.add.image(0, 0, 'finalScene').setOrigin(0.5);
        finalContainer.add(finalImg);
        
        // Final √∂ƒüelerini kaydet
        this.registry.set('finalContainer', finalContainer);
        this.registry.set('finalImg', finalImg);

        // EKRAN BOYUTU DEƒûƒ∞≈ûƒ∞RSE
        this.scale.on('resize', (gameSize) => {
            if(bgFar) bgFar.setSize(gameSize.width, gameSize.height);
            if(bgMid) bgMid.setSize(gameSize.width, gameSize.height * 0.6);
            if(bgFront) bgFront.setSize(gameSize.width, gameSize.height * 0.25);
            positionButtons(this);
        });
    }

    function update() {
        // Arka plan hareketi
        const camX = this.cameras.main.scrollX;
        bgFar.tilePositionX = camX * 0.12;
        bgMid.tilePositionX = camX * 0.25;
        bgFront.tilePositionX = camX * 0.45;

        // Hareketli platform mantƒ±ƒüƒ±
        this.physics.world.bodies.entries.forEach(b => {
            if (b.gameObject && b.gameObject.minMoveX !== undefined) {
                const go = b.gameObject;
                if (go.moveRight) {
                    go.body.setVelocityX(go.moveSpeed);
                    if (go.x > go.maxMoveX) go.moveRight = false;
                } else {
                    go.body.setVelocityX(-go.moveSpeed);
                    if (go.x < go.minMoveX) go.moveRight = true;
                }
            }
        });

        // HAREKET KONTROLLERƒ∞
        const onGround = player.body.blocked.down || player.body.touching.down;
        let moving = false;

        if (cursors.left.isDown || isLeft) {
            player.setVelocityX(-260);
            player.setFlipX(true);
            moving = true;
        } else if (cursors.right.isDown || isRight) {
            player.setVelocityX(260);
            player.setFlipX(false);
            moving = true;
        } else {
            player.setVelocityX(0);
        }

        // ZIPLAMA
        if ((cursors.up.isDown || isJump) && onGround) {
            player.setVelocityY(-620);
            isJump = false; // Basƒ±lƒ± tutmayƒ± engelle
        }

        // EFEKT
        if (emitter) {
            emitter.on = moving && onGround;
            // Prens'in ayaklarƒ±nƒ±n altƒ±na koy
            emitter.setPosition(player.x, player.y);
        }

        // D√ú≈ûME KONTROL√ú
        if (player.y > this.scale.height + 200) {
            this.scene.restart();
            this.registry.set('score', 0);
        }
    }

    // --- YARDIMCI FONKSƒ∞YONLAR ---

    function createFloor(scene, group, startX, endX) {
        const width = endX - startX;
        const centerX = startX + width / 2;
        const y = scene.scale.height - (GROUND_HEIGHT / 2);

        const floor = group.create(centerX, y, 'ground');
        floor.setDisplaySize(width, GROUND_HEIGHT);
        floor.setTint(0x1e8b3a); // Ye≈üil Zemin
        floor.refreshBody();
    }

    function createBlock(group, x, y) {
        const b = group.create(x, y, 'ground');
        b.setDisplaySize(120, 32);
        b.setTint(0x3b2f1b); // Kahverengi Blok
        b.refreshBody();
    }

    function setMovingData(go, minX, maxX, speed) {
        go.minMoveX = minX;
        go.maxMoveX = maxX;
        go.moveSpeed = speed;
        go.moveRight = true;
        go.body.setCollideWorldBounds(true);
    }

    function moveWithPlatform(playerObj, platform) {
        if (playerObj.body.touching.down && platform.body.touching.up) {
            playerObj.x += platform.body.velocity.x * (1/60);
        }
    }

    function collectHeart(playerObj, heart) {
        heart.disableBody(true, true);
        let s = this.registry.get('score') || 0;
        s += 10;
        this.registry.set('score', s);
        scoreText.setText('Toplanan Sevgi: ' + s);
    }

    function reachPrincess(playerObj, princessObj) {
        const scene = playerObj.scene;
        scene.physics.pause();
        playerObj.setVisible(false);
        princessObj.setVisible(false);
        scoreText.setVisible(false);
        
        // Tu≈ülarƒ± gizle
        const left = scene.registry.get('uiLeft');
        const right = scene.registry.get('uiRight');
        const jump = scene.registry.get('uiJump');
        if (left) left.setVisible(false);
        if (right) right.setVisible(false);
        if (jump) jump.setVisible(false);
        if (emitter) emitter.on = false;

        // Final Sahnesi
        const finalContainer = scene.registry.get('finalContainer');
        const finalImg = scene.registry.get('finalImg');

        finalContainer.setVisible(true);
        finalContainer.x = scene.scale.width / 2;
        finalContainer.y = scene.scale.height / 2;
        
        // Resmi ekranƒ± kaplayacak ≈üekilde ayarla
        finalImg.setDisplaySize(scene.scale.width, scene.scale.height);
        
        scene.add.text(scene.scale.width / 2, 60, 'MUTLU SON ‚ù§Ô∏è', {
            fontSize: '50px', fill: '#fff', stroke: '#000', strokeThickness: 8, fontFamily: 'Arial Black'
        }).setOrigin(0.5).setScrollFactor(0).setDepth(1001);
    }

    // --- MOBƒ∞L TU≈ûLAR ---
    function createMobileButtons(scene) {
        const w = 130, h = 110, radius = 20;
        const g = scene.make.graphics({x:0, y:0, add:false});
        g.fillStyle(0x000000, 0.35);
        g.fillRoundedRect(0, 0, w, h, radius);
        g.lineStyle(4, 0xffffff, 0.08);
        g.strokeRoundedRect(0, 0, w, h, radius);
        g.generateTexture('btnBg', w, h);
        g.clear();

        // Sol Tu≈ü
        btnLeft = scene.add.image(0, 0, 'btnBg').setScrollFactor(0).setInteractive();
        const leftArrow = scene.add.text(0, 0, '‚¨ÖÔ∏è', { fontSize: '56px' }).setOrigin(0.5);
        const leftContainer = scene.add.container(0, 0, [btnLeft, leftArrow]).setScrollFactor(0).setDepth(20);
        leftContainer.setSize(w, h);
        leftContainer.setInteractive(new Phaser.Geom.Rectangle(-w/2, -h/2, w, h), Phaser.Geom.Rectangle.Contains);
        leftContainer.on('pointerdown', () => isLeft = true);
        leftContainer.on('pointerup', () => isLeft = false);
        leftContainer.on('pointerout', () => isLeft = false);

        // Saƒü Tu≈ü
        btnRight = scene.add.image(0, 0, 'btnBg').setScrollFactor(0).setInteractive();
        const rightArrow = scene.add.text(0, 0, '‚û°Ô∏è', { fontSize: '56px' }).setOrigin(0.5);
        const rightContainer = scene.add.container(0, 0, [btnRight, rightArrow]).setScrollFactor(0).setDepth(20);
        rightContainer.setSize(w, h);
        rightContainer.setInteractive(new Phaser.Geom.Rectangle(-w/2, -h/2, w, h), Phaser.Geom.Rectangle.Contains);
        rightContainer.on('pointerdown', () => isRight = true);
        rightContainer.on('pointerup', () => isRight = false);
        rightContainer.on('pointerout', () => isRight = false);

        // Zƒ±plama Tu≈üu
        btnJump = scene.add.image(0, 0, 'btnBg').setScrollFactor(0).setInteractive();
        const jumpArrow = scene.add.text(0, 0, '‚è´', { fontSize: '48px' }).setOrigin(0.5);
        const jumpContainer = scene.add.container(0, 0, [btnJump, jumpArrow]).setScrollFactor(0).setDepth(20);
        jumpContainer.setSize(w, h);
        jumpContainer.setInteractive(new Phaser.Geom.Rectangle(-w/2, -h/2, w, h), Phaser.Geom.Rectangle.Contains);
        jumpContainer.on('pointerdown', () => isJump = true);
        jumpContainer.on('pointerup', () => isJump = false);
        jumpContainer.on('pointerout', () => isJump = false);

        scene.registry.set('uiLeft', leftContainer);
        scene.registry.set('uiRight', rightContainer);
        scene.registry.set('uiJump', jumpContainer);

        positionButtons(scene);
    }

    function positionButtons(scene) {
        const left = scene.registry.get('uiLeft');
        const right = scene.registry.get('uiRight');
        const jump = scene.registry.get('uiJump');
        if (!left || !right || !jump) return;

        const bottomY = scene.scale.height - 80;

        left.setPosition(80, bottomY);
        right.setPosition(220, bottomY);
        jump.setPosition(scene.scale.width - 80, bottomY);
    }

})();
</script>
</body>
</html>
